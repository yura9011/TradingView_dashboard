{% extends "base.html" %}

{% block title %}Dashboard - Trading Analysis{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>üìä Analysis Dashboard</h1>
    <p class="subtitle">AI-powered technical analysis with Wyckoff & Elliott Wave</p>
</div>

<div class="signals-table-container">
    <table class="signals-table">
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Status</th>
                <th>Confidence</th>
                <th>Trend</th>
                <th>Wyckoff</th>
                <th>Pattern</th>
                <th>Last Analysis</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for signal in signals %}
            <tr
                class="signal-row {% if signal.signal_type == 'candidate' %}candidate{% elif signal.signal_type == 'not_candidate' %}not-candidate{% else %}pending{% endif %}">
                <td class="symbol">
                    <strong>{{ signal.symbol }}</strong>
                </td>
                <td class="status">
                    {% if signal.signal_type == 'candidate' %}
                    <span class="badge badge-success">‚úÖ CANDIDATE</span>
                    {% elif signal.signal_type == 'not_candidate' %}
                    <span class="badge badge-danger">‚ùå NOT VIABLE</span>
                    {% else %}
                    <span class="badge badge-warning">‚è≥ PENDING</span>
                    {% endif %}
                </td>
                <td class="confidence">
                    <div class="progress-bar">
                        <div class="progress" style="width: {{ (signal.confidence * 100)|int }}%"></div>
                        <span>{{ (signal.confidence * 100)|int }}%</span>
                    </div>
                </td>
                <td class="trend">
                    {% if signal.trend == 'up' %}
                    <span class="trend-up">üìà UP</span>
                    {% elif signal.trend == 'down' %}
                    <span class="trend-down">üìâ DOWN</span>
                    {% else %}
                    <span class="trend-sideways">‚û°Ô∏è SIDE</span>
                    {% endif %}
                </td>
                <td class="phase">
                    {% if signal.market_phase %}
                    <span class="phase-{{ signal.market_phase }}">{{ signal.market_phase|title }}</span>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="pattern">
                    {{ signal.pattern|replace('_', ' ')|title if signal.pattern and signal.pattern != 'none' else '-' }}
                </td>
                <td class="timestamp">
                    {{ signal.timestamp[:16] if signal.timestamp else '-' }}
                </td>
                <td class="action">
                    <a href="/signal/{{ signal.id }}" class="btn btn-primary">View Details</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" class="empty-state">
                    <p>No signals yet. Run an analysis first!</p>
                    <code>python main_multiagent.py --symbol MELI</code>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="stats-summary">
    <div class="stat-card">
        <h3>{{ signals|length }}</h3>
        <p>Total Stocks</p>
    </div>
    <div class="stat-card candidate">
        <h3>{{ signals|selectattr('signal_type', 'equalto', 'candidate')|list|length }}</h3>
        <p>Candidates</p>
    </div>
    <div class="stat-card pending">
        <h3>{{ signals|selectattr('signal_type', 'equalto', 'pending')|list|length }}</h3>
        <p>Pending</p>
    </div>
</div>
{% endblock %}